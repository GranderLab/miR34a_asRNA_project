---
title: "miR34a asRNA stable over-expression cell lines"
author: "Jason T. Serviss"
date: "04/01/2017"
output:
  html_document:
    theme: flatly
    toc: no
    code_folding: hide
---

#Introduction
miR34a asRNA over-expressing cell lines, previously generated, showed a high overexpression level of miR34a asRNA despite a low multiplicity of infection. This is most likley due to the fact that all infected cell lines have practically no endogenous miR34a asRNA expression. To investigate the physiological relevance of the over-expression the miR34a asRNA levels were compared to the expression levels in HEK293t cells, which have a high endogenous miR34a expression level.

#Methods
See "stableLineExpression.rmd" file.

#Results

```{r}
library(reshape2)
library(ggplot2)
library(ggthemes)
library(plyr)
data <- read.table('~/GitHub/miR34aFigures/inst/StableLineExpressionHEK/QPCR.txt', header=TRUE, sep="\t")

#extract AS experiment
as <- data
asRNA <- data[data$Gene == "miR34a asRNA F1R1", ]
colnames(asRNA)[c(5,6,7)] <- c("Ct1GOI", "Ct2GOI", "Ct3GOI")

bact <- data[data$Gene == "B-actin", ]
colnames(bact)[c(5,6,7)] <- c("Ct1HK", "Ct2HK", "Ct3HK")

asRNA <- cbind(asRNA, bact[ ,c("Ct1HK", "Ct2HK", "Ct3HK")])
asRNA$Condition <- ifelse(asRNA$Condition == "F4", "miR34a AS", as.character(asRNA$Condition))

#remove PC3 experiment 6, B-act mean Ct > 30, too high.
asRNA <- asRNA[asRNA$experiment != 6 | asRNA$cellLine != "PC3", ]

asRNA$meanGOI <- rowMeans(asRNA[ ,c("Ct1GOI", "Ct2GOI", "Ct3GOI")], na.rm=TRUE)
asRNA$meanHK <- rowMeans(asRNA[ ,c("Ct1HK", "Ct2HK", "Ct3HK")], na.rm=TRUE)

#perform ddct
asRNA$dct <- asRNA$meanGOI - asRNA$meanHK

ddct <- ddply(
    asRNA, 
    c("experiment", "cellLine", "Condition"), 
    summarize, 
    ddct=dct-asRNA[asRNA$experiment == 3 & asRNA$cellLine == "HEK293t" & asRNA$Condition == "wt", "dct"]
)

asRNA <- merge(asRNA, ddct, by=c("experiment", "cellLine", "Condition"), all=TRUE)
asRNA$fold <- 2^-asRNA$ddct
asRNA$log2Fold <- log2(asRNA$fold)

#run statistics
pValues <- ddply(
    asRNA, 
    c("cellLine", "Condition"), 
    summarize,
    mean=mean(log2Fold),
    conf.intLow = t.test(log2Fold, mu=0)$conf.int[1],
    conf.intHigh = t.test(log2Fold, mu=0)$conf.int[2]
)

asRNA <- merge(asRNA, pValues, by=c("cellLine", "Condition"), all.x=TRUE)

#prepare for plotting
asRNA$cellLine <- factor(asRNA$cellLine, levels=c("HEK293t", "PC3", "Skov3", "Saos2"))
asRNA$Condition <- ifelse(asRNA$Condition == "miR34a AS", "miR34a asRNA", as.character(asRNA$Condition))
asRNA$Condition <- factor(asRNA$Condition, levels=c("wt", "mock", "miR34a asRNA"))

```

```{r, fig.align='center', fig.height=8, fig.width=12, eval=TRUE, message=FALSE, warning=FALSE}
#plot for rmarkdown
ggplot(asRNA, aes(x=Condition, y=log2Fold))+
    geom_violin(
        aes(fill=Condition),
        scale="width",
        trim=TRUE,
        alpha=0.3,
        color=NA,
        show.legend = FALSE
    )+
    geom_point(
        data=asRNA, 
        aes(colour=Condition), 
        size=3, 
        alpha=0.8
    )+
    geom_point(
        aes(y=mean),
        colour="black",
        show.legend = FALSE
    )+
    geom_linerange(
        aes(ymin=conf.intLow, ymax=conf.intHigh),
        show.legend = FALSE
    )+
    facet_grid(.~cellLine, scales = "free")+
    scale_y_continuous(
        "\u0394\u0394Ct", 
        sec.axis = sec_axis(
            ~2^., 
            name = expression(2^{- ~ Delta ~ Delta ~ "Ct"}), breaks=c(0.00001, 0.00005, 0.0001, 0.0005, 0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1, 5, 10, 50))
    )+
    labs(
        x="Cell line",
        title="miR34a asRNA",
        caption=
            "miR34a asRNA over-expression levels in PC3, Skov3, and Saos2 stable cell lines compared to HEK293t cells.\n\u0394\u0394ct = target gene - House keeping gene - HEK293t. Error bars indicate 95% CI and black points represent the mean."
    )+
    theme_few()+
    scale_color_ptol()+
    scale_fill_ptol()+
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=20
        ),
        plot.caption = element_text(
            hjust=0, 
            margin=margin(t=15)
        ),
        legend.position="none",
        axis.title=element_text(size=17),
        axis.title.x=element_text(margin=margin(t=10)),
        axis.text=element_text(size=15),
        strip.text.x = element_text(size = 15)
    )

p <- ggplot(asRNA, aes(x=Condition, y=log2Fold))+
    geom_violin(
        aes(fill=Condition),
        scale="width",
        trim=TRUE,
        alpha=0.3,
        color=NA,
        show.legend = FALSE,
        lwd=0.1
    )+
    geom_point(
        data=asRNA, 
        aes(colour=Condition), 
        size=0.6, 
        alpha=0.8
    )+
    geom_point(
        aes(y=mean),
        colour="black",
        show.legend = FALSE,
        size=0.5
    )+
    geom_linerange(
        aes(ymin=conf.intLow, ymax=conf.intHigh),
        show.legend = FALSE,
        lwd=0.2
    )+
    facet_grid(.~cellLine, scales = "free")+
    scale_y_continuous(
        "\u0394\u0394Ct"
        #sec.axis = sec_axis(
        #    ~2^., 
        #    name = expression(2^{- ~ Delta ~ Delta ~ "Ct"}), breaks=c(0.00001, 0.0001, 0.001, 0.01, 0.1, 1, 10))
    )+
    labs(
        x="Cell line"
        #title="miR34a asRNA"
    )+
    theme_few()+
    scale_color_ptol()+
    scale_fill_ptol()+
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=10
        ),
        plot.margin = unit(rep(0.1,4), "lines"),
        legend.position="none",
        axis.title=element_text(size=9),
        axis.title.x=element_text(margin=margin(t=5)),
        axis.text.x=element_text(size=8, angle=90, vjust=0.5, hjust=1),
        axis.text.y=element_text(size=6),
        strip.text.x = element_text(size = 9),
        panel.border = element_rect(fill=NA, size=0.25),
        axis.ticks = element_line(size=0.25),
        axis.ticks.length = unit(1/15, "cm"),
        axis.line=element_line(size=0.15),
    )

ggsave(plot=p, filename="~/GitHub/miR34aFigures/inst/StableLineExpressionHEK/StableLineExpHEK293t.pdf", device=cairo_pdf, height=60, width=83, units="mm")
```

#Conclusions
Results indicate that miR34a asRNA is over-expressed 13-22 fold greater that endogenous HEK293t levels. 