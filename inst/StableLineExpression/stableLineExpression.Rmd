---
title: "miR34a asRNA stable over-expression cell lines"
author: "Jason T. Serviss"
date: "04/01/2017"
output:
  html_document:
    theme: flatly
    toc: no
    code_folding: hide
---

#Introduction
We hypothesized that miR34a asRNA may function to mediate the levels of its sense gene, miR34a. To this end, we stably over-expressed miR34a asRNA, using lentiviral transduction, in 3 different p53-null cell lines and monitored the effects on miR34a.

#Methods

##miR34a asRNA cloning
RNA was harvested from U2OS cells using the RNeasy mini kit (Qiagen) and subsequently treated with DNase (Ambion Turbo DNA-free, Life Technologies). 500ng RNA was used for cDNA synthesis using MuMLV (Life Technologies) and a 1:1 mix of oligo(dT) and random nanomers. PCR was run using the miR34aAS_cloning_F4 and miR34aAS_cloning_Ex3_1 primers for 40 cycles at annealing temperature 58˚C and run on an agarose gel. Bands were excised and extracted using the QIAquick gel extraction kit (Qiagen). PCR products were cloned using the Strata Clone kit (Aligent) and sequenced (results below). The insert for the lentiviral construct (p-HIV-I2AG-U6) was subsequently sub-cloned from the sequenced plasmid using primers with PacI and NheI cleavage sites. The cloned transcript largley mirrors the GENCODE annotated transcript.

###Cloning primers
```{r}
library(printr)
primers <- data.frame(
    name=c(
        "miR34aAS_cloning_F4",
        "miR34aAS_cloning_Ex3_1"
    ),
    sequence=c(
        "ACGCGTCTCTCCAGCCCGGGAT",
        "AATGATGGCCGCAACTAATGACGG"
    )
)
primers
```

###Sequencing results
```{r}
construct <- data.frame(
    name="miR34a_asRNA",
    sequence="ACG CGT CTC TCC AGC CCG GGA TCC GGG GAG CTG GGC TGT CCC CAG ACC GAC GGG ACA GCG GCA
                TCT CCT CCA CCT GAA AAG GAA AGA GGA CCA GTT TGC AGG ACT CCG AAC TGG GCC CGC GAG ATC 
                TCC ACC TGC GCA AAA CGA AAG GGC GGA TTC TCC TTG GAC TCA CGA GGC AAC CGC TCC CCG GGG 
                TGA GAA CGG GGG ACT CAT TCC TCC GGC ACT GGG AGA AGA CGA TTC TTC AGG AGG AGG ACA GGG 
                AAG CGA ATG CTA CCC AGA TGT CTC AGT ATA CTG GCT CGC GGC ACA TCG GGC AAA TGA ACC TAT 
                CAG ATA ACA ACG GCA GAT CAG ATG CCT GAG CAT TCA GAA GCA ACA GCT GTG GAG CCC CCG TGG 
                GTT CAG AAG GCC TGG TTC CCG TCT CCA GAA GCC TGG CTC TCC TCC CTC CTG GGC CCA CTA CTT 
                TGG CTT CTT GTT CCT ACG TAC AAG GAG TTG CGA AGA AGG CAA CTC TTC CCC TCC CTG AAG CCA
                AAG GAA TGA AAC AGA CTA GGG CGG GAG AGG TGG CCA TCC GTC ATT AGT TGC GGC CAT CA"
)
construct
```

```{r}
###Q-PCR primers
primers <- data.frame(
    name=c(
        "ß-actin Fwd",
        "ß-actin Rev",
        "miR34a_asF1",
        "miR34a_asR1"
        
    ),
    sequence=c(
        "AGGTCATCACCATTGGCAATGAG",
        "CTTTCGGGATGTCCACGTCA",
        "AGCGGCATCTCCTCCACCTGAAA",
        "TTGCCTCGTGAGTCCAAGGAGAAT"
        
    )
)
primers
```

##Lentivirus production and infection
HEK293T cells were transfected with viral and expression constructs using Lipofectamine 2000 (Life Technologies), after which viral supernatants were harvested 48 and 72 hours post-transfection. Viral particles were concentrated using PEG-IT solution (Systems Biosciences) according to the manufacturer’s recommendations. HEK293T cells were used for virus titration and GFP expression was evaluated 72hrs post-infection via flow cytometry after which TU/ml was calculated. Cell lines were subsequently infected with the lentiviral particals using a multuplicity of infection = 1. After 48 hours, cells were placed under mycophenolic acid selection and the selection process was monitored using GFP expression via flow cytometry. When GFP expression was present in >90% of the cells, cells were frozen for downstream analysis.

##QPCR
RNA was extracted using the RNeasy mini kit (Qiagen) and subsequently treated with DNase (Ambion Turbo DNA-free, Life Technologies). 500ng RNA was used for cDNA synthesis using MuMLV (Life Technologies) and a 1:1 mix of oligo(dT) and random nanomers. QPCR was carried out using KAPA 2G SYBRGreen (Kapa Biosystems) using the Applied Biosystems 7900HT machine with the cycling conditions: 95 °C for 3 min, 95 °C for 3 s, 60 °C for 30 s.
QPCR for miRNA expression analysis was performed according to the protocol for the TaqMan microRNA Assay kit (Life Technologies) with primer/probe sets purchased from the same company (TaqMan® MicroRNA Assay, hsa-miR-34a, human and Control miRNA Assay, RNU48, human) and the same cycling scheme as above.

#Results

```{r, message=FALSE}
library(reshape2)
library(ggplot2)
library(ggthemes)
library(plyr)
library(extrafont)
data <- read.table('~/GitHub/miR34aFigures/inst/StableLineExpression/QPCR.txt', header=TRUE, sep="\t")
data$Gene <- gsub("miR34a asRNA F1R1", "miR34a asRNA", data$Gene)
colnames(data)[3] <- "condition"

#extract AS experiment
asRNA <- data[data$Gene %in% c("miR34a asRNA", "miR34a"), ]
bact <- data[data$Gene %in% c("B-actin", "RNU48"), ]
colnames(asRNA)[c(5,6,7)] <- c("Ct1GOI", "Ct2GOI", "Ct3GOI")
colnames(bact)[c(5,6,7)] <- c("Ct1HK", "Ct2HK", "Ct3HK")
asRNA <- cbind(asRNA, bact[ ,c("Ct1HK", "Ct2HK", "Ct3HK")])

#remove Skov exp 1 due to variability in technical replicates
asRNA <- asRNA[asRNA$experiment != 1 | asRNA$cellLine != "Skov3", ]

asRNA$meanGOI <- rowMeans(asRNA[ ,c("Ct1GOI", "Ct2GOI", "Ct3GOI")], na.rm=TRUE)
asRNA$meanHK <- rowMeans(asRNA[ ,c("Ct1HK", "Ct2HK", "Ct3HK")], na.rm=TRUE)

#perform ddct
asRNA$dct <- asRNA$meanGOI - asRNA$meanHK
ddct <- ddply(
    asRNA, 
    c("experiment", "cellLine", "condition", "Gene"), 
    summarize, 
    ddct=dct-asRNA[asRNA$experiment == 2 & asRNA$cellLine == cellLine & asRNA$condition == "mock" & asRNA$Gene == Gene, "dct"]
)
asRNA <- merge(asRNA, ddct, by=c("experiment", "cellLine", "condition", "Gene"), all=TRUE)
asRNA$fold <- 2^-asRNA$ddct
asRNA$log2Fold <- log2(asRNA$fold)
asRNA$sample <- paste(asRNA$cellLine, asRNA$condition, sep=" ")

#run statistics
pValues <- ddply(
    asRNA, 
    c("sample", "Gene"), 
    summarize,
    meanLog2Fold = mean(log2Fold),
    pValue=t.test(log2Fold, mu=0)$p.value, 
    conf.intLow = t.test(log2Fold, mu=0)$conf.int[1],
    conf.intHigh = t.test(log2Fold, mu=0)$conf.int[2]
)
asRNA <- merge(asRNA, pValues, by=c("sample", "Gene"), all.x=TRUE)

#prepare for plotting
asRNA$cellLine <- factor(asRNA$cellLine, levels=c("PC3", "Skov3", "Saos2"))
asRNA$condition <- ifelse(asRNA$condition == "miR34a AS", "miR34a\nasRNA", "mock")
asRNA$condition <- factor(asRNA$condition, levels=c("mock", "miR34a\nasRNA"))
asRNA$Gene <- factor(asRNA$Gene, levels=c("miR34a asRNA", "miR34a"))
asRNA[grepl("mock", asRNA$condition), "pValue"] <- NaN
asRNA$sample <- gsub("([a-zA-Z]*[0-9]{1}) (.*)", "\\1\n\\2", asRNA$sample)
asRNA$sample <- factor(asRNA$sample, levels=c("PC3\nmock", "PC3\nmiR34a AS", "Skov3\nmock", "Skov3\nmiR34a AS", "Saos2\nmock", "Saos2\nmiR34a AS"))

asRNA$pStars <- ifelse(
    asRNA$pValue < 0.05 & asRNA$pValue > 0.0049, 
    "\u2605", 
    ifelse(
        asRNA$pValue < 0.005 & asRNA$pValue > 0.00049, 
        "\u2605\u2605",
        ifelse(
            asRNA$pValue < 0.0005, 
            "\u2605\u2605\u2605",
            ""
        )
    )
)
```

```{r, fig.align='center', fig.height=8, fig.width=12, eval=TRUE, message=FALSE, warning=FALSE}

pBars <- data.frame(
    Gene=rep(unique(asRNA[grepl("miR34a AS", asRNA$sample), "Gene"]), 3),
    condition=unique(asRNA[grepl("miR34a AS", asRNA$sample), "condition"]),
    cellLine=unique(asRNA[grepl("miR34a AS", asRNA$sample), "cellLine"])
)
pBars <- pBars[order(pBars$cellLine, pBars$Gene), ]
pBars$x <- rep(c(0.775,1.225), 3)
pBars$xend <- rep(c(1.775,2.225), 3)

asRNA <- merge(asRNA, pBars, by=c("Gene", "condition", "cellLine"), all.x=TRUE)

#plot for rmarkdown
ggplot(asRNA, aes(x=condition, y=log2Fold))+
    geom_violin(
        aes(group=interaction(condition, Gene)),
        trim=TRUE,
        alpha=0.5,
        fill="grey",
        colour=NA,
        scale="width",
        show.legend = FALSE
    )+
    geom_point(
        aes(colour=Gene, group=interaction(condition, Gene)),
        size=2, 
        alpha=0.75,
        position=position_dodge(width=0.9)
    )+
    geom_linerange(
        aes(ymin=conf.intLow, ymax=conf.intHigh, group=interaction(condition, Gene)),
        position=position_dodge(width=0.9),
        colour="grey25",
        show.legend = FALSE
    )+
    geom_point(
        aes(y=meanLog2Fold, group=interaction(condition, Gene)),
        colour="black",
        size=1,
        position=position_dodge(width=0.9),
        show.legend = FALSE
    )+
    geom_label(
        aes(y=conf.intHigh+0.5, label=pStars, fontface="bold", group=interaction(condition, Gene)),
        fill="white",
        label.size=0,
        label.padding=unit(0.01, "lines"),
        position=position_dodge(width=0.9),
        show.legend = FALSE,
        family="Arial Unicode MS",
        size=3
    )+
    facet_grid(
        .~cellLine, 
        scales = "free", 
        space = "free"
    )+
    scale_y_continuous(
        "\u0394\u0394Ct", 
        sec.axis = sec_axis(
            ~2^., 
            name = expression(2^{- ~ Delta ~ Delta ~ "Ct"}), 
            breaks=c(1,5,10,50,100,500,1000,5000,10000,50000)
        )
    )+
    labs(
        x="Cell line",
        title="miR34a asRNA over-expressing cell lines",
        caption=
            "miR34a asRNA and miR34a levels in PC3, Skov3, and Saos2 cell lines stably over-expressing miR34a asRNA compared to mock over-expressing control.\n\u0394\u0394ct = House keeping gene - Target gene - mock control. Error bars indicate 95% CI and black points represent the mean.\n\u2605 = p < 0.05; \u2605\u2605 = p < 0.005, \u2605\u2605\u2605 = p < 0.0005."
    )+
    theme_few()+
    scale_colour_ptol()+
    theme(
        legend.position = "top",
        legend.title=element_text(size=17),
        legend.text=element_text(size=15),
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=20
        ),
        plot.caption = element_text(
            hjust=0, 
            margin=margin(t=15),
            family="Arial Unicode MS"
        ),
        axis.title=element_text(size=17),
        axis.title.x=element_text(margin=margin(t=10)),
        axis.text=element_text(size=12),
        strip.text.x = element_text(size=17)
    )

#plot for pdf
p <- ggplot(asRNA, aes(x=condition, y=log2Fold))+
    geom_violin(
        aes(fill=Gene, group=interaction(condition, Gene)),
        trim=TRUE,
        alpha=0.3,
        colour=NA,
        scale="width",
        lwd = 0.1
    )+
    #geom_point(
    #    aes(colour=Gene, group=interaction(condition, Gene)),
    #    size=0.4, 
    #    position=position_dodge(width=0.9)
    #)+
    geom_linerange(
        aes(ymin=conf.intLow, ymax=conf.intHigh, group=interaction(condition, Gene)),
        position=position_dodge(width=0.9),
        colour="black",
        show.legend = FALSE,
        lwd=0.2
    )+
    geom_point(
        aes(y=meanLog2Fold, group=interaction(condition, Gene)),
        colour="black",
        size=0.1,
        position=position_dodge(width=0.9),
        show.legend = FALSE
    )+
    geom_label(
        aes(y=conf.intHigh+0.5, label=pStars, fontface="bold", group=interaction(condition, Gene)),
        fill="white",
        label.size=0,
        label.padding=unit(0.01, "lines"),
        position=position_dodge(width=0.9),
        show.legend = FALSE,
        size=1,
        family="Arial Unicode MS"
    )+
    facet_grid(
        .~cellLine, 
        scales = "free", 
        space = "free"
    )+
    scale_y_continuous(
        "\u0394\u0394Ct" 
        #sec.axis = sec_axis(
        #    ~2^., 
        #    name = expression(2^{- ~ Delta ~ Delta ~ "Ct"}), 
        #    breaks=c(1,10,100,1000,10000,50000)
        #)
    )+
    labs(
        x="Cell line"
        #title="miR34a asRNA over-expressing cell lines"
    )+
    theme_few()+
    scale_colour_ptol()+
    scale_fill_ptol()+
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=10,
            margin=margin(b=2, unit="mm")
        ),
        plot.margin = unit(rep(0.1,4), "lines"),
        legend.position = "top",
        legend.margin=unit(1,"mm"),
        legend.key.size = unit(1/5, "cm"),
        legend.title=element_text(size=9),
        legend.text=element_text(size=7),
        axis.title=element_text(size=9),
        axis.title.x=element_text(margin=margin(t=5)),
        axis.text.y=element_text(size=8),
        axis.text.x=element_text(size=7),
        #axis.line=element_line(size=0.25),
        axis.ticks = element_line(size=0.25),
        axis.ticks.length = unit(1/15, "cm"),
        strip.text.x = element_text(size=8, margin = margin(0.01, 0, 0.1, 0, "cm")),
        panel.border = element_rect(fill=NA, size=0.15)
    )+ 
    guides(
        fill=guide_legend(
            override.aes = list(
                size=2
            )
        )
    )

ggsave(plot=p, filename="~/GitHub/miR34aFigures/inst/StableLineExpression/StableLineExp.pdf", device=cairo_pdf, height=60, width=83, units="mm")
```

#Conclusion
miR34a asRNA over-expression causes a concominant up-regulation of miR34a in all 3 cell lines. This indicates that miR34a asRNA concordantly regulates miR34a.