---
title: "Monitoring growth of miR34a asRNA overexpressings cells under conditions of starvation."
author: "Jason T. Serviss"
date: "30/01/2017"
output:
  html_document:
    theme: flatly
    toc: no
    code_folding: hide
---

#Introduction
As p53 is a well-known regulator of senescence and apoptosis and has been shown to specifically importatnt under conditions of cellular stress, such as starvation. Therefore, we investigated whether overexpression of miR34a AS affects growth rate under normal and starvation conditions by measuring changes in confluency over time.

#Methods
10^4 PC3 cells, either miR34a asRNA overexpressing or WT, were seeded in 96 well plates. After attachment (3-4h) media was replaced with either RPMI (Gibco, life technology) (supplemented with 2mM L-glutamine, 50ug/ml Penicillin-Streptomycin and 10% Fetal Calf Serum) or HBSS. Cells were incubated in Spark Multimode Microplate reader for 48 hours at 37Â°C with 5% CO2 in a humidity chamber. Confluency was measured every hour. 

#Analysis

Load the data.
```{r, message = FALSE}
packages <- c(
    "tidyverse",
    "printr",
    "ggthemes",
    "readr"
)
purrr::walk(packages, library, character.only = TRUE)
rm(packages)

data <- read.table('~/GitHub/miR34aFigures/inst/growthStarvation/rawData.txt', header=TRUE, sep="\t") %>%
    filter(Time <= 35) %>%
    mutate(Time = parse_factor(Time, levels = as.character(0:max(Time)))) %>%
    mutate(Treatment = parse_factor(Treatment, levels = c("RPMI", "HBSS"))) %>%
    mutate(cellLine = paste(Cell.line, Condition, sep = "-")) %>%
    mutate(cellLine = case_when(
        cellLine == "PC3-F4" ~ "miR34a asRNA",
        cellLine == "PC3-Mock" ~ "mock"
    )) %>%
    select(-Cell.line, -Condition) %>%
    mutate(cellLine = parse_factor(cellLine, levels = c("mock", "miR34a asRNA"))) %>%
    as_tibble() 


```

Normalize the data to time point 0 for each condition.
```{r}
#normalize to first time point for control (Mock)
data <- data %>%
    group_by(Treatment, Biological.replicate, Technical.replicate, Time, cellLine) %>%
    mutate(normConfluency = Confluency / pull(data, Confluency)[data$Treatment == Treatment & data$Biological.replicate == Biological.replicate & data$Technical.replicate == Technical.replicate & data$Time == 0 & data$cellLine == cellLine]) %>%
    ungroup()
```

Plot each biological replicate with the technical replicates representing the variation.
```{r, fig.align='center', fig.height=8, fig.width=12, eval=TRUE, message=FALSE, warning=FALSE}
data %>%
    ggplot(aes(Time, normConfluency)) +
        geom_boxplot(aes(fill = cellLine)) +
        facet_grid(Biological.replicate~Treatment) +
        theme_few() +
        theme(
            axis.text.x = element_text(angle = 90)
        )
```

Conclusion: miR34a asRNA overexpression leads to decreased growth in both conditions in all biological replicates with the effect being more pronounced in HBSS (starvation).

Calculate the mean of the technical replicates for each condition and plot with the biological replicates representing the variability. 
```{r, fig.align='center', fig.height=8, fig.width=12, eval=TRUE, message=FALSE, warning=FALSE}
#calculate mean for each technical replicate
data <- data %>%
    group_by(Treatment, Biological.replicate, Time, cellLine) %>%
    summarize(
        tech.mean = mean(normConfluency)
    ) %>%
    ungroup()

data %>%
    ggplot(aes(Time, tech.mean)) +
    geom_boxplot(aes(fill = cellLine)) +
    facet_grid(.~Treatment) +
        theme_few() +
        theme(
            axis.text.x = element_text(angle = 90)
        )
```

Calculate the mean, median, and 95% CI for each condition (using the biological replicates).
```{r}
stats <- data %>%
    filter(Time != 0) %>%
    group_by(cellLine, Treatment, Time) %>%
    summarize(
        min = min(tech.mean),
        max = max(tech.mean),
        mean = mean(tech.mean),
        median = median(tech.mean),
        CI95l = t.test(tech.mean)$conf.int[1],
        CI95h = t.test(tech.mean)$conf.int[2]
    )
```

#Results

```{r, fig.align='center', fig.height=8, fig.width=12, eval=TRUE, message=FALSE, warning=FALSE}
#plot for Rmarkdown
ggplot(data = NULL) + 
    geom_ribbon(
        data = stats,
        aes(x = Time, ymin = CI95l, ymax = CI95h, group = cellLine, fill = cellLine), 
        alpha = 0.2,
        show.legend = TRUE
    ) +
    geom_linerange(
        data = stats,
        aes(x = Time, colour = cellLine, ymin = min, ymax = max), 
        position = position_dodge(width = 1),
        show.legend = FALSE
    ) + 
    geom_point(
        data = stats,
        aes(x = Time, y = median, group = cellLine, colour = cellLine), 
        position = position_dodge(width = 1),
        show.legend = FALSE
    ) +
    facet_grid(. ~ Treatment) +
    scale_x_discrete(breaks = seq(0, 47, 5)) +
    theme_few() +
    scale_fill_ptol() +
    scale_colour_ptol() +
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face = "bold",
            size = 20
        ),
        plot.caption = element_text(
            hjust = 0, 
            margin = margin(t = 15),
            family = "Arial Unicode MS"
        ),
        legend.position = "top",
        legend.title = element_text(size = 17),
        legend.text = element_text(size = 15),
        axis.title = element_text(size = 17),
        axis.title.x = element_text(margin = margin(t = 10)),
        axis.text = element_text(size = 15),
        strip.text.x = element_text(size = 17)
    ) +
    labs(
        x = "Time (hours)", 
        y = "Normalized % confluency",
        title = "miR34a asRNA's role in growth regulation.",
        caption = "The effects of miR34a asRNA overexpression on growth in normal and starvation conditions in the PC3 prostate cancer cell line."
    ) +
    guides(
        fill = guide_legend(title = "Cell line"), 
        colour = guide_legend(title = "Cell line")
    )

p <- ggplot(data = NULL) +
    geom_ribbon(
        data = stats,
        aes(x = Time, ymin = CI95l, ymax = CI95h, group = cellLine, fill = cellLine), 
        alpha = 0.2,
        show.legend = TRUE
    ) +
    geom_linerange(
        data = stats,
        aes(x = Time, colour = cellLine, ymin = min, ymax = max), 
        position = position_dodge(width = 1),
        show.legend = FALSE,
        lwd = 0.1
    ) + 
    geom_point(
        data = stats,
        aes(x = Time, y = median, group = cellLine, colour = cellLine), 
        position = position_dodge(width = 1),
        size = 0.05,
        show.legend = FALSE
    ) + 
    facet_grid(. ~ Treatment) +
    scale_x_discrete(breaks = seq(0, 47, 5)) +
    labs(
        x = "Time (hours)", 
        y = "Normalized % confluency"
    ) +
    theme_few() +
    scale_fill_ptol() +
    scale_colour_ptol() +
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=10,
            margin=margin(b=2, unit="mm")
        ),
        plot.margin = unit(c(0.1,0.1,0.1,0.1), "lines"),
        legend.position="top",
        legend.spacing=unit(1,"mm"),
        legend.key.size = unit(1/5, "cm"),
        legend.title=element_text(size=9),
        legend.text=element_text(size=8),
        axis.title=element_text(size=9),
        axis.title.x=element_text(margin=margin(t=5)),
        axis.text.y=element_text(size=8),
        axis.text.x=element_text(size=7),
        strip.text.x=element_text(size=9, margin = margin(0.01, 0, 0.1, 0, "cm")),
        panel.border = element_rect(fill=NA, size=0.25),
        axis.ticks = element_line(size=0.25),
        axis.ticks.length = unit(1/15, "cm")
    )+
    guides(
        fill = guide_legend(title = "Cell line"),
        colour = guide_legend(title = "Cell line")
    )

ggsave(plot=p, filename="~/GitHub/miR34aFigures/inst/growthStarvation/growthStarvation.pdf", device=cairo_pdf, height=60, width=83, units="mm")
```

#Conclusions
miR34a asRNA overexpression causes a minor decrease in cell growth under normal conditions (RPMI) although under conditions of cellular stress through starvation, this effect is increased dramatically. 