---
title: "lnc34a CAGE"
author: "Jason T. Serviss"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    code_folding: hide
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<style> 
.caption { 
  color: Black; 
  font-family: "Times New Roman", Times, serif;
  font-size: 1.0em; 
}
</style>

Add number of cell lines included in figure.

```{r, message = FALSE}
packages <- c(
    "tidyverse",
    "grid",
    "gtable",
    "miR34AasRNAproject"
)
purrr::walk(packages, library, character.only = TRUE)
rm(packages)
```

####Introduction

[Wang et al.](https://www.ncbi.nlm.nih.gov/pubmed/27077950) have previously published concerning a antisense transcript arising from the miR34a locus that they named "lnc34a". Wang et al. state find that this transcript is expressed at "significantly higher levels in colon cancer stem cells spheres (CCSCs)" compared to 9 commonly used colorectal cancer cell lines. After obtaining the sequence for lnc34a we could confirm that neither our primer walk analysis or our 3' RACE detected the lnc34a transcripts presence in the cell lines we had utilized. To further investigate the presence of lnc34a in non-CCSC cell lines we interogated CAGE data from RIKEN to investigate the possibility of an alternative transcription start site upstream of the transcription start site we had characterized. 
<br></br>

####Methods
All available CAGE data was downloaded from UCSC with the script entitled "lnc34a CAGE" in the data-raw/saveRDA.R file. CAGE tags mapping to the plus strand of chromosome 1 and in regions corresponding to 200 bp upstream of the lnc34a start site (9241796 - 200) and 200 bp upstream of the GENCODE annotated miR34a asRNA start site (9242263 + 200) were filtered from the total data. All CAGE reads were plotted and the RPKM of the individual reads was used to color each read to indicate their relative abundance. In addition, a density plot shows the distribution of the CAGE reads at in the specified interval. ADD NUMBER OF CELL LINES.

<br></br>

####Results

```{r}
data <- tibble(
  gene = readr::parse_factor(
    c(rep("miR34a asRNA", 5), rep("lnc34a", 3)),
    levels = c("miR34a asRNA", "lnc34a")
  ),
  feature = c(
    "exon", "intron", "exon", "intron",
    "exon", "exon", "intron", "exon"
  ),
  start = c(
    9242262, 9242375, 9243691, 9243866,
    9251451, 9241796, 9242354, 9256971),
  stop = c(
    9242375, 9243691, 9243866, 9251451,
    9252148, 9242354, 9256971, 9257102
  )
)

pw <- tibble(
  gene = paste("F", 10:15, sep = ""),
  feature = rep("primer", 6),
  start = c(9242282, 9242170, 9242037, 9241944, 9241838, 9241734),
  stop = c(9242303, 9242192, 9242058, 9241967, 9241861, 9241757)
)

dataUrl <- "https://github.com/GranderLab/miR34a_asRNA_project/raw/master/data"
url <- "lnc34aCAGE.rds"
cage <- read_rds(gzcon(url(file.path(dataUrl, url)))) %>%
    arrange(desc(level)) %>%
    mutate(y = 1:length(pull(., level)))

```

```{r, fig.align='center', fig.height=8, fig.width=12}
###plot

p1 <- ggplot(data = NULL) +
  gggenes::geom_gene_arrow(
    data = filter(data, feature == "exon"),
    aes(xmin = start, xmax = stop, y = gene, fill = gene),
    arrowhead_width = unit(0, "mm"),
    arrowhead_height = unit(0, "mm"),
    colour = "gray"
  ) +
  ggthemes::theme_few() +
  ggthemes::scale_fill_ptol() +
  geom_segment(
    data = filter(data, feature == "intron"),
    aes(x = start, xend = stop, y = gene, yend = gene),
    linetype = "dotted",
    colour = "gray",
    size = 1
  ) +
  xlim(9241000, 9257900) +
  labs(x = "Chromosome 1", y = "Genes") +
  guides(fill = FALSE)

p2 <- ggplot(data = NULL) +
  gggenes::geom_gene_arrow(
    data = cage,
    aes(xmin = start, xmax = stop, y = y, fill = level),
    arrowhead_width = unit(0, "mm"),
    arrowhead_height = unit(0, "mm"),
    arrow_body_height = unit(2, "mm"),
    colour = "gray",
    show.legend = TRUE
  ) +
  ggthemes::theme_few() +
  viridis::scale_fill_viridis() +
  theme(
    axis.title.x = element_blank(),
    legend.position = "top",
    axis.text = element_blank(),
    axis.ticks = element_blank()
  ) +
  labs(y = "Cage reads") +
  xlim(9241000, 9257900) +
  guides(fill = guide_colourbar(title = "RPKM", title.position = "top", title.hjust = 0.5))

p3 <- ggplot(data = NULL) + 
  geom_density(data = cage, aes(x = start)) +
  ggthemes::theme_few() +
  xlim(9241000, 9257900) +
  theme(
    axis.text = element_blank(),
    axis.title.x = element_blank(),
    axis.ticks = element_blank()
  ) +
  labs(y = "Density")

grobz <- lapply(list(p1, p2, p3), ggplotGrob)
g <- rbind(grobz[[2]], grobz[[3]], grobz[[1]], size = "last")
grid.newpage()
grid.draw(resize_heights(g, unit(c(3,1,1), "null")))
```

<div class="caption">
CAGE tags (top), CAGE tag density (middle), and antisense genes (bottom) at the miR34a locus. CAGE tags are colored according to their corresponding RPKM values.
</div>

<br></br>

####Conclusions

The results show a high density of CAGE tags aligning to the region corresponding to the annotated miR34a asRNA start site. An additional peak, albeit with a much lower average expression, aligns slightly upstream of the annotated miR34a asRNA start site and corresponds to the upstream start site detected in our primer walk analysis (figure 1e). Despite this, we find no CAGE tags aligning at the transcription start site or upstream of the transcription start site of the lnc34a transcript. This potentially indicates that lnc34a is tightly regulated and specifically expressed in the CCSC context, as claimed by the authors. An alternative intrepretation could be that lnc34a expression is present in a subset of the examined cell lines although at too low levels to be detected. 

<br></br><br></br>
