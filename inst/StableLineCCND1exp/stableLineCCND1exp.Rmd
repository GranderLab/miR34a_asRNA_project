---
title: "CCND1 expression in PC3 stable cell lines"
author: "Jason T. Serviss"
date: "12/01/2017"
output:
  html_document:
    theme: flatly
    toc: no
    code_folding: hide
---

#Introduction
To further investigate the characteristics of the miR34a asRNA stable lines, we measured the expression level of known miR34a target cyclin D1. miR34a has been previously shown to inhibit cell cycle progression, partially via its regulation of cyclin D1.

#Methods
All cell lines were cultured at 5% CO2 and 37° C with PC3 cells in RPMI (Hyclone) and 2 mM L-glutamine. All growth mediums were supplemented with 10% heat-inactivated FBS and 50 μg/ml of streptomycin and 50 μg/ml of penicillin. Cells were seeded at 2x10^5 cells per well in a 12-well plate. After 24 hours, RNA was extracted using the RNeasy mini kit (Qiagen) and subsequently treated with DNase (Ambion Turbo DNA-free, Life Technologies). 500ng RNA was used for cDNA synthesis using MuMLV (Life Technologies) and a 1:1 mix of oligo(dT) and random nanomers. QPCR was carried out using KAPA 2G SYBRGreen (Kapa Biosystems) using the Applied Biosystems 7900HT machine with the cycling conditions: 95 °C for 3 min, 95 °C for 3 s, 60 °C for 30 s.

```{r}
library(printr)
primers <- data.frame(
    name=c(
        "CCND1 Fwd",	
        "CCND1 Rev",
        "B-actin_F",
        "B-actin_R"
    ),
    sequence=c(
        "CGT GGC CTC TAA GAT GAA GG",
        "CTG GCA TTT TGG AGA GGA AG",
        "AGG TCA TCA CCA TTG GCA ATG AG",
        "CTT TGC GGA TGT CCA CGT CA"
    )
)
primers
```

#Results

```{r, warning=FALSE, message=FALSE}
library(reshape2)
library(ggplot2)
library(ggthemes)
library(plyr)
library(scales)
library(extrafont)

data <- read.table('~/GitHub/miR34aFigures/inst/StableLineCCND1exp/QPCRdata.txt', header=TRUE, sep="\t")
goi <- data[data$gene == "CCND1", ]
hk <- data[data$gene == "B-actin", ]
colnames(goi)[c(5,6)] <- c("Ct1GOI", "Ct2GOI")
colnames(hk)[c(5,6)] <- c("Ct1HK", "Ct2HK")
hk$gene <- NULL

data <- merge(goi, hk, by=c("experiment", "cellLine", "condition"))
data$meanGOI <- rowMeans(data[,c("Ct1GOI", "Ct2GOI")])
data$meanHK <- rowMeans(data[,c("Ct1HK", "Ct2HK")])

#ddct
data$dct <- data$meanGOI - data$meanHK
ddct <- ddply(
    data,
    c("experiment", "condition"),
    summarize,
    ddct=dct-data[data$experiment == 2 & data$condition == "mock", "dct"]
)
data <- merge(data, ddct, by=c("experiment", "condition"), all.x=TRUE)
data$fold <- 2^-data$ddct
data$log2fold <- log2(data$fold)

#calculate stats
stats <- ddply(
    data,
    c("condition"),
    summarize, 
    mean=mean(log2fold),
    pValue=t.test(log2fold, data[data$condition == "mock", "log2fold"])$p.value,
    CI95l=t.test(log2fold)$conf.int[1],
    CI95h=t.test(log2fold)$conf.int[2]
)
stats[stats$condition == "mock", "pValue"] <- NA

stats$pStars <- ifelse(
    stats$pValue < 0.05 & stats$pValue > 0.0049, 
    "\u2605", 
    ifelse(
        stats$pValue < 0.005 & stats$pValue > 0.00049, 
        "\u2605\u2605",
        ifelse(
            stats$pValue < 0.0005, 
            "\u2605\u2605\u2605",
            ""
        )
    )
)

data <- merge(data, stats, by="condition", all.x=TRUE)

#prepare for plotting
data$condition <- ifelse(data$condition == "mock", "mock", "miR34a\nasRNA")
data$condition <- factor(data$condition, levels=c("mock", "miR34a\nasRNA"))
```

```{r, fig.align='center', fig.height=8, fig.width=12, eval=TRUE, message=FALSE, warning=FALSE}
#plot for Rmarkdown
ggplot(data, aes(x=condition, y=log2fold))+
    geom_violin(
        aes(fill=condition),
        trim=TRUE,
        alpha=0.3,
        color=NA,
        scale="width"
    )+
    geom_point( 
        aes(colour=condition),
        size=4
    )+
    geom_linerange(
        aes(ymin=CI95l, ymax=CI95h),
        colour="black"
    )+
    geom_point(
        aes(x=condition, y=mean),
        colour="black"
    )+
    geom_segment(
        aes(x=1, y=0.175, xend=2, yend=0.175),
        colour="grey43"
    )+
    geom_label(
        data=stats,
        aes(x=1.5, y=0.19, label=pStars),
        label.size=0,
        label.padding=unit(0.01, "lines"),
        show.legend = FALSE,
        fill="white",
        size=5,
        family="Arial Unicode MS"
    )+
    scale_y_continuous(
        "\u0394\u0394Ct", 
        sec.axis = sec_axis(
            ~2^., 
            name = expression(2^{- ~ Delta ~ Delta ~ "Ct"}), 
            breaks=c(0.7,0.8,0.9,1,1.1,1.3)
        )
    )+
    labs(
      x="Cell line",
      title="CCND1",
      caption=
            "Q-PCR showing cyclin D1 levels in PC3 miR34a asRNA over-expressing stable lines. Error bars (black vertical) indicate 95% CI and means are represented \nby black dots. \u2605 = p < 0.05; \u2605\u2605 = p < 0.005, \u2605\u2605\u2605 = p < 0.0005."
    )+
    theme_few()+
    scale_fill_ptol()+
    scale_colour_ptol()+
    #values=c("#014d64", "#6794a7")
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=20
        ),
        plot.caption = element_text(
            hjust=0, 
            margin=margin(t=15),
            family="Arial Unicode MS"
        ),
        legend.position="none",
        axis.title=element_text(size=17),
        axis.title.x=element_text(margin=margin(t=10)),
        axis.text=element_text(size=15)
    )

#plot for pdf
p <- ggplot(data, aes(x=condition, y=log2fold))+
    geom_violin(
        aes(fill=condition),
        trim=TRUE,
        alpha=0.3,
        color=NA,
        scale="width",
        lwd=0.1
    )+
    #geom_point( 
    #    aes(colour=condition),
    #    size=0.4
    #)+
    geom_linerange(
        aes(ymin=CI95l, ymax=CI95h),
        colour="black",
        lwd=0.15
    )+
    geom_point(
        aes(x=condition, y=mean),
        colour="black",
        size=0.5
    )+
    geom_segment(
        aes(x=1, y=0.175, xend=2, yend=0.175),
        colour="grey43",
        lwd=0.15
    )+
    geom_label(
        data=stats,
        aes(x=1.5, y=0.19, label=pStars),
        label.size=0,
        label.padding=unit(0.01, "lines"),
        show.legend = FALSE,
        fill="white",
        family="Arial Unicode MS",
        size=1
    )+
    scale_y_continuous(
        "\u0394\u0394Ct"
        #sec.axis = sec_axis(
        #    ~2^., 
        #    name = expression(2^{- ~ Delta ~ Delta ~ "Ct"}), 
        #    breaks=c(0.7,0.8,0.9,1,1.1,1.3)
        #)
    )+
    labs(
      x="Cell line",
      title="CCND1 gene"
    )+
    theme_few()+
    scale_fill_ptol()+
    scale_colour_ptol()+
    #values=c("#014d64", "#6794a7")
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=10
        ),
        plot.margin = unit(rep(0.1,4), "lines"),
        legend.position="none",
        axis.title=element_text(size=9),
        axis.title.x=element_text(margin=margin(t=5)),
        axis.text=element_text(size=8),
        panel.border = element_rect(fill=NA, size=0.25),
        axis.ticks = element_line(size=0.25),
        axis.ticks.length = unit(1/15, "cm")
    )

ggsave(plot=p, filename="~/GitHub/miR34aFigures/inst/StableLineCCND1exp/stableLineCCND1exp.pdf", device=cairo_pdf, height=60, width=42, units="mm")

```

#Conclusions
CCND1 expression levels are decreased in PC3 cell lines stably over-expressing miR34a asRNA.