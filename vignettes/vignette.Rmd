---
title: "Vignette Title"
author: "Jason T. Serviss"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: yes
    code_folding: hide
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
library(printr)
library(RCurl)
```

```{r}
projectUrl <- "https://github.com/GranderLab/miR34a_asRNA_project/raw/master/inst/"
dataUrl <- "https://github.com/GranderLab/miR34a_asRNA_project/raw/master/data"
```

### Figure 1a
####Introduction
An antisense transcript to the miR34a HG was detected using the UCSC genome browser.
<br></br><br></br>

####Methods
The USCS genome browser was utilized for the bioinformatic evaluation of antisense transcription utilizing the Human EST and ENCODE RNAseq tracks.
<br></br><br></br>

####Results
```{r, out.width = "850px"}
url <- "miR34aLocus/miR34aLocus_hg38.png"
knitr::include_graphics(file.path(projectUrl, url))
```
<br></br>
A schematic picture of the miR34a locus from UCSC genome browser (hg38) including miR34a HG and mature miR34a, and LINC01759. H3K4me3 ChIP-seq data and conservation over the locus is also shown.
<br></br><br></br>

####Conclusion
GENCODE annotation supports the presence of a transcript orinionating in the antisense orientation from the miR34a gene. 

###Figure 1b
####Introduction
We wished to examine expression in different tissue types and, therefore, utilized a panel of common cell lines to detect miR34a asRNA expression, as well as, miR34a HG. We included both p53+/+ and p53-/- cell lines in the cell line panel due to the fact that miR34a is a known downstream target of p53. 
<br></br><br></br>

####Methods
Cells were cultured with the appropriate growth medium and seeded at a desity between 50-75% confluency. The following day, RNA was extracted using the RNeasy mini kit (Qiagen) and subsequently treated with DNase (Ambion Turbo DNA-free, Life Technologies). 500ng RNA was used for cDNA synthesis using MuMLV (Life Technologies) and a 1:1 mix of oligo(dT) and random nanomers. PCR was run for 35 or 38 or 16 cycles for miR34a asRNA, miR34a HG, and beta-actin, respectivley, with 58˚C annealing temperature. PCR products were analyzed on a 2% agarose gel.
<br></br><br></br>

#####Primers

```{r}
primers <- data.frame(
    name=c(
        "miR34a asRNA F1",
        "miR34a asRNA R1",
        "miR34aHG_F",
        "miR34aHG_R",
        "B-actin_F",
        "B-actin_R"
    ),
    sequence=c(
        "AGC GGC ATC TCC TCC ACC TGA AA",
        "TTG CCT CGT GAG TCC AAG GAG AAT",
        "TCT GCT CCA GTG GCT GAT GAG AAA",
        "GTT CAC TGG CCT CAA AGT TGG CAT",
        "AGG TCA TCA CCA TTG GCA ATG AG",
        "CTT TGC GGA TGT CCA CGT CA"
    )
)
primers
```

####Results
```{r, out.width = "850px"}
url <- "miR34aASExpressionCellPanel/cellPanelLarge.png"
knitr::include_graphics(file.path(projectUrl, url))
```
<br></br>
Semi-quantitative PCR data from the screening of a panel of cell lines. 
* Indicates that, although the cell line is p53wt, other mechanisms are present which inhibit p53 function. 
<br></br><br></br>

####Conclusions
We were able to detect co-expression of both miR34a HG and miR34a AS in a variety of cell lines, including HCT116 human colon cancer cells and 293T human embryonic kidney cells. A correlation was observed between both miR34a HG and miR34a asRNA expression and p53 status, with p53+/+ cell lines tending to have higher expression of both transcripts.

###Figure 1c

#Insert code here from Erik and write Intro Methods etc

####Results
```{r, out.width = "850px"}
url <- "TCGAcorrelation/miR34a_RP3-510D11.2_diploid_only_edited.png"
knitr::include_graphics(file.path(projectUrl, url))
```
<br></br>

###Figure 1d
####Introduction
In order to define the 3' transcription stop site for the miR34a asRNA, 3'-RACE was performed.
<br></br><br></br>

####Methods
All cell lines were cultured at 5% CO2 and 37° C with U2OS cells grown in McCoy’s 5a (Life Technologies). All growth mediums were supplemented with 10% heat-inactivated FBS and 50 μg/ml of streptomycin and 50 μg/ml of penicillin. U2OS cell RNA was polyA-tailed using yeast polyA polymerase after which cDNA was synthesized using oligo(dT) primers. Nested-PCR was performed first using a forward primer in miR34a asRNA exon 1 (miR-34a asRNA F10 forward primer - ACGCGTCTCTCCAGCCCGGGAT) and a tailed oligo(dT) primer (poly T T7-FAM) followed by a second PCR using an alternate miR34a asRNA exon 1 primer (miR-34a asRNA F1 forward primer - AGCGGCATCTCCTCCACCTGAAA) and a reverse primer binding to the tail of the previously used oligo(dT) primer (FAM primer). PCR products were gel purified and cloned the Strata Clone Kit (Agilent Technologies), and sequenced.
<br></br><br></br>

####Results
```{r, out.width = "850px"}
url <- "3primeRACE/results_hg38.png"
knitr::include_graphics(file.path(projectUrl, url))
```
<br></br>
3’-RACE sequencing results displayed in the UCSC genome browser together with the annotated miR34a asRNA transcript from GENCODE.
<br></br><br></br>

####Conclusions
Sequencing of the resulting cloned cDNA indicated the transcripts 3’ transcription termination site to be 125bp upstream of the RP3-510D11.2 transcript’s annotated termination site.

###Figure 1e
####Introduction
We desired to determine the 5'-start site for the miR34a asRNA.
<br></br><br></br>

####Methods
To accomplish this we performed the primer walk assay. All cell lines were cultured at 5% CO2 and 37° C with HEK293T cells cultured in DMEM high glucose (Hyclone). All growth mediums were supplemented with 10% heat-inactivated FBS and 50 μg/ml of streptomycin and 50 μg/ml of penicillin. RNA was extracted using the RNeasy mini kit (Qiagen) and subsequently treated with DNase (Ambion Turbo DNA-free, Life Technologies). 500ng RNA was used for cDNA synthesis using MuMLV (Life Technologies) and a 1:1 mix of oligo(dT) and random nanomers. PCR was performed for 35 cycles at 62°C annealing temperature and the resulting products were analyzed on a 2% agarose gel.
<br></br><br></br>

#####Primers
```{r}
primers <- data.frame(
    name=c(
        "miR34aAS_F10",
        "miR34aAS_F11",
        "miR34aAS_F12",
        "miR34aAS_F13",
        "miR34aAS_F14",
        "miR34aAS_F15",
        "miR34aAS_R1"
    ),
    sequence=c(
        "ACG CGT CTC TCC AGC CCG GGA T",
        "ATC TGC GTG GTC ACC GAG AAG CA",
        "CGC ACG GAC TGA GAA ACA CAA G",
        "ACG GAG GCT ACA CAA TTG AAC AGG",
        "AGG GAA GAA AGA ACT AGC CGA GCA",
        "CAT TTG CTG CAA TAT CAC CGT GGC",
        "TTG CCT CGT GAG TCC AAG GAG AAT"
    )
)
primers
```

<br></br><br></br>

####Results

```{r, out.width = "850px"}
url <- "primerWalk/schematic_hg38.png"
knitr::include_graphics(file.path(projectUrl, url))
```
<br></br>

A schematic picture of the miR34a asRNA locus including the location of the primers used in the primer walk assay.
<br></br>

```{r, out.width = "500px"}
url <- "primerWalk/gel.png"
knitr::include_graphics(file.path(projectUrl, url))
```
<br></br>
The semi-quantitative PCR results from the primer walk assay performed using HEK293T cells.
<br></br><br></br>

####Conclusion
It appears as though the miR34a asRNA transcript start site is somewhat upstream of the annotated start site. Although there is some product present for the F12 primer, the majority of transcription seems to be originating from the F11 primer. This indicates that the start site is between 71-224bp upstream of the annotated start site.

###Figure 1f and supplementary figure ??????????????
####Introduction
We utilized a bioinformatic approach to evaluate the coding potential of the miR34a asRNA transcript. The Coding-potential assessment tool uses a linear regression model to evaluate coding-potential by examining ORF length, ORF coverage, Fickett score and hexamer score. We further confirmed these results using the Coding-potential Calculator which utilizes a support based machine-based classifier and accesses an alternate set of discriminatory features.
<br></br><br></br>

####Methods
Protein-coding capacity was evaluated using the [Coding-potential Assessment Tool](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3616698/) and [Coding-potential Calculator](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1933232/) with default settings. Transcript sequences for use with Coding-potential Assessment Tool were downloaded from the UCSC genome browser using the following IDs: HOTAIR (ENST00000455246.1), XIST (ENST00000429829.1), β-actin (ENST00000331789.5), Tubulin (ENST00000427480.1), and MYC (ENST00000377970). Transcript sequences for use with Coding-potential Calculator were downloaded from the UCSC genome browser using the following IDs: HOTAIR (uc031qho.1), β-actin (uc003soq.4).
<br></br><br></br>

####Results
#####Coding Potential Assesment Tool


```{r}
url <- "codingPotential/CodingPotentialAssessmentTool/results.txt"
cpat <-read.table(url(file.path(projectUrl, url)), header = TRUE, sep = "\t")
cpat
```

<br></br>

Coding potential analysis results from the Coding-potential Assessment Tool including miR34a asRNA and two characterized non-coding transcripts (HOTAIR and XIST) and 3 known coding transcripts (β-actin, tubulin, and MYC). 

#####Coding Potential Calculator
```{r}
url <- "codingPotential/CodingPotentialCalculator/results.txt"
cpc <- read.table(url(file.path(projectUrl, url)), header = TRUE, sep = "\t")
cpc
```

<br></br>

Coding potential analysis results using the Coding-potential calculator for miR34a asRNA, HOTAIR, and β-actin.

<br></br><br></br>

####Conclusions
Results indicated that miR34a asRNA has a similar lack of coding capacity to the known non-coding transcripts HOTAIR and XIST and differs greatly when examining these parameters to the known coding transcripts beta-actin, tubulin, and MYC. However, to fully evaluate coding potential methods such as mass spectrometry or ribosome profiling must be used. 

###Figure 2a

####Introduction
miR34a is a known downstream target of p53 and has been previously shown to exhibit increased expression with cellular apoptotic signaling. We hypothesized that miR34a asRNA may be regulated in a similar fashion whereby transcription is stimulated by activation of p53. To test this we treated p53+/+ and p53-/- HCT116 cells with increasing concentrations of the DNA damaging agent doxorubicin and monitored miR34a asRNA expression.
<br></br><br></br>

####Methods
HCT116 cells were cultured in DMEM high modified (Hyclone, GE healthcare) supplemented with supplemented with 2mM L-glutamine, 50ug/ml Penicillin-Streptomycin and 10% Fetal Calf Serum.  
25 x 10^5 HCT116 cells were plated in 6 well plates. 24 hours later media was exchanged and doxorubicin was added to a final concentration of 100, 200 or 500 ng/ml. Cells were harvested for RNA extraction 24 hours later using trypsin. RNA was extracted using Nucleospin RNA kit (Machery-Nagel Ref. 740955) according to manufacturer‟s protocol and DNase treated using Ambion Turbo DNA-free according to manufacturer‟s protocol (Life Technologies Ref. AM1907). cDNA was synthesized using ~500 ng RNA with M-MLV (Life Technologies Ref 28025013) and a mixture of oligo(dT) with nanomers in accordance with the manufacturer's protocol.
qPCR quantification was carried out using the PowerUp SYBR Green Master Mix (Thermo Fisher Scientific, Ref. A25777) on the CFX96 Touch Real-Time PCR Detection System: 50°C for 2 min, 95°C for 2min, and 95°C for 1 sec followed by 60°C for 30 sec repeated for 40 cycles. The following primers were used:
<br></br><br></br>

#####Primers
```{r}
primers <- data.frame(
    name=c(
        "ß-actin Fwd",
        "ß-actin Rev",
        "miR34a HG_F",
        "miR34a HG_R",
        "miR34a_asF1",
        "miR34a_asR1"
        
    ),
    sequence=c(
        "AGGTCATCACCATTGGCAATGAG",
        "CTTTCGGGATGTCCACGTCA",
        "TCTGCTCCAGTGGCTGATGAGAAA",
        "GTTCACTGGCCTCAAAGTTGGCAT",
        "AGCGGCATCTCCTCCACCTGAAA",
        "TTGCCTCGTGAGTCCAAGGAGAAT"
        
    )
)
primers
```
<br></br><br></br>

####Results

Perform ddct analysis and statistical testing.
```{r}
library(reshape2)
library(ggplot2)
library(ggthemes)
library(plyr)
url <- "HCT116null.rda?raw=True"
repmis::source_data(file.path(dataUrl, url))
goi <- subset(data, Gene %in% c("miR34a AS", "miR34a HG")) 
hk <- subset(data, Gene == "Actin")

colnames(goi)[c(6:7)] <- c("Ct1GOI", "Ct2GOI")
colnames(hk)[c(6:7)] <- c("Ct1HK", "Ct2HK")

data <- merge(goi, hk[, colnames(hk) != "Gene"], by = c("Condition", "Treatment", "Biological.Replicate", "Cell.line"))


#ddct
data$meanGOI <- rowMeans(data[, c("Ct1GOI", "Ct2GOI")])
data$meanHK <- rowMeans(data[, c("Ct1HK", "Ct2HK")])
data$dct <- data$meanGOI - data$meanHK
ddct <- ddply(
    data,
    c("Gene", "Condition", "Treatment", "Biological.Replicate"),
    summarize,
    ddct=dct-data[data$Gene == Gene & data$Condition == Condition & data$Treatment == 0 & data$Biological.Replicate == Biological.Replicate, "dct"]
)

data <- merge(data, ddct, by=c("Gene", "Condition", "Treatment", "Biological.Replicate"))
data$fold <- 2^-data$ddct
data$log2fold <- log2(data$fold)

#calculate stats
stats <- ddply(
    data, 
    c("Gene", "Condition", "Treatment"),
    summarize,
    n=length(log2fold),
    mean=mean(log2fold),
    pValue=t.test(log2fold, data[data$Gene == Gene & data$Condition == "WT" & data$Treatment == Treatment, "log2fold"])$p.value,
    CI95l=t.test(log2fold)$conf.int[1],
    CI95h=t.test(log2fold)$conf.int[2]
)

data <- merge(data, stats, by = c("Gene", "Condition", "Treatment"))
#data$pValue <- ifelse(data$pValue == 1, NA, data$pValue)

data$pStars <- ifelse(
    data$pValue < 0.05 & data$pValue > 0.0049, 
    "\u2605", 
    ifelse(
        data$pValue < 0.005 & data$pValue > 0.00049, 
        "\u2605\u2605",
        ifelse(
            data$pValue < 0.0005, 
            "\u2605\u2605\u2605",
            "n.s."
        )
    )
)

yS <- ddply(data, c("Gene", "Treatment"), summarize, max = max(CI95h))
pBars <- ddply(
    data, 
    c("Gene", "Condition", "Treatment"),
    summarize,
    CI95l = unique(CI95l),
    CI95h = unique(CI95h),
    pStars = unique(pStars),
    pValue = unique(pValue)
)
pBars[pBars$Condition == "WT", "pStars"] <- ""
pBars <- merge(pBars, yS, by = c("Gene", "Treatment"))
pBars$x <- dplyr::case_when(
    pBars$Treatment ==   0 ~ 1 + 0.25,
    pBars$Treatment == 100 ~ 2 + 0.25,
    pBars$Treatment == 200 ~ 3 + 0.25,
    pBars$Treatment == 500 ~ 4 + 0.25
)

pBars$xend <- dplyr::case_when(
    pBars$Treatment ==   0 ~ 1 - 0.25,
    pBars$Treatment == 100 ~ 2 - 0.25,
    pBars$Treatment == 200 ~ 3 - 0.25,
    pBars$Treatment == 500 ~ 4 - 0.25
)

#prepare for plotting
data$Treatment <- factor(data$Treatment, levels=c("0", "100", "200", "500"))
pBars$Treatment <- factor(pBars$Treatment, levels=c("0", "100", "200", "500"))
data$Condition <- ifelse(data$Condition == "WT", "p53-wt", "p53-null")
pBars$Condition <- ifelse(pBars$Condition == "WT", "p53-wt", "p53-null")
data$Condition <- factor(data$Condition, levels=c("p53-wt", "p53-null"))
pBars$Condition <- factor(pBars$Condition, levels=c("p53-wt", "p53-null"))

data$Gene <- ifelse(data$Gene == "miR34a AS", "miR34a asRNA", "miR34a HG")
data$Gene <- factor(data$Gene, levels = c("miR34a HG", "miR34a asRNA"))
pBars$Gene <- ifelse(pBars$Gene == "miR34a AS", "miR34a asRNA", "miR34a HG")
pBars$Gene <- factor(pBars$Gene, levels = c("miR34a HG", "miR34a asRNA"))
```

Plot the results.
```{r, fig.align='center', fig.height=8, fig.width=12, eval=TRUE, message=FALSE, warning=FALSE}
#plot for Rmarkdown
ggplot(data = NULL) +
    geom_violin(
        data = data,
        aes(x = Treatment, y = log2fold, fill = Condition),
        trim = TRUE,
        alpha = 0.3,
        color = NA,
        scale = "width",
        show.legend = TRUE
    ) +
    geom_point(
        data = data,
        aes(x = Treatment, y = mean, group = Condition), 
        position = position_dodge(width = 0.9), 
        size = 4
    ) +
    facet_grid(. ~ Gene) +
    geom_linerange(
        data = pBars,
        aes(x = Treatment, ymin = CI95l, ymax = CI95h, group = Condition),
        colour = "black",
        position = position_dodge(width = 0.9),
        show.legend = FALSE
    ) +
    geom_label(
        data = pBars,
        aes(x = Treatment, y = max + 0.22, label = pStars),
        label.size = 0,
        label.padding = unit(0.01, "lines"),
        show.legend = FALSE,
        fill = "white",
        size = 5,
        family = "Arial Unicode MS",
        position = position_dodge(width = 0.9)
    ) +
    geom_segment(
        data = pBars,
        aes(x = x, y = max + 0.1, xend = xend, yend = max + 0.1),
        colour="grey43",
        show.legend = FALSE
    ) +
    scale_y_continuous(
        "\u0394\u0394Ct",
        breaks=c(-1,0,1,2,3,4,5),
        sec.axis = sec_axis(
            ~2^., 
            name = expression(2^{- ~ Delta ~ Delta ~ "Ct"}), 
            breaks=c(2^-1,2^0,2^1,2^2,2^3,2^4,2^5)
        )
    )+
    labs(
      x="Treatment",
      title="miR34a asRNA regulation by p53 induction",
      caption=
            "Monitoring the effects of 24 hours doxorubicin treatment on miR34a asRNA and HG in P53+/+ and p53-/- HCT116 cells."
    )+
    theme_few()+
    scale_fill_ptol()+
    scale_colour_ptol()+
    #values=c("#014d64", "#6794a7")
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=20
        ),
        plot.caption = element_text(
            hjust=0, 
            margin=margin(t=15),
            family="Arial Unicode MS"
        ),
        legend.position = "top",
        legend.title=element_text(size=17),
        legend.text=element_text(size=15),
        axis.title=element_text(size=17),
        axis.title.x=element_text(margin=margin(t=10)),
        axis.text=element_text(size=15),
        strip.text.x=element_text(size=17)
    )+
    guides(fill = guide_legend(title = "Cell line", override.aes = list(size=3)))
```
<br></br><br></br>

####Conclusions
We observed increasing miR34a HG and asRNA expression with increasing doses of doxorubicin indicating that these two transcripts are co-regulated by p53. Although p53+/+ cells showed a 25-fold increase over untreated cells in miR34a AS expression at the highest tested doxorubicin concentration, this effect was largely abrogated, 11 fold over untreated, in p53-/- cells, indicating that p53 is a major regulator of miR34a asRNA expression. 

###Figure 2b
#Introduction
miR34a is a known downstream target of p53 and has been previously shown to exhibit increased expression with cellular apoptotic signaling. We hypothesized that miR34a asRNA may be regulated in a similar fashion whereby transcription is stimulated by activation of p53. To test this we treated HCT116 and HEK293t cells with 200 ng/ml of the DNA damaging agent doxorubicin for 24 hours and monitored miR34a asRNA expression. 

#Methods
All cell lines were cultured at 5% CO2 and 37° C with HEK293T cells cultured in DMEM high glucose (Hyclone) and HCT116 cells in McCoy’s 5a (Life Technologies). All growth mediums were supplemented with 10% heat-inactivated FBS and 50 μg/ml of streptomycin and 50 μg/ml of penicillin. Cells were plated at 300,000 cells per well in a 6-well plate and cultured overnight. The following day cells were treated with 0, 100, 200, or 500 ng/ml doxorubicin for 24hrs. RNA was extracted using the RNeasy mini kit (Qiagen) and subsequently treated with DNase (Ambion Turbo DNA-free, Life Technologies). 500ng RNA was used for cDNA synthesis using MuMLV (Life Technologies) and a 1:1 mix of oligo(dT) and random nanomers. QPCR was carried out using KAPA 2G SYBRGreen (Kapa Biosystems) using the Applied Biosystems 7900HT machine with the cycling conditions: 95 °C for 3 min, 95 °C for 3 s, 60 °C for 30 s.

```{r}
library(printr)
primers <- data.frame(
    name=c(
        "ß-actin Fwd",
        "ß-actin Rev",
        "miR34a HG_F",
        "miR34a HG_R",
        "miR34a_asF1",
        "miR34a_asR1"
        
    ),
    sequence=c(
        "AGGTCATCACCATTGGCAATGAG",
        "CTTTCGGGATGTCCACGTCA",
        "TCTGCTCCAGTGGCTGATGAGAAA",
        "GTTCACTGGCCTCAAAGTTGGCAT",
        "AGCGGCATCTCCTCCACCTGAAA",
        "TTGCCTCGTGAGTCCAAGGAGAAT"
        
    )
)
primers
```

#Results
```{r}
library(reshape2)
library(ggplot2)
library(ggthemes)
library(plyr)
url <- "HctHekDox?raw=True"
repmis::source_data(file.path(dataUrl, url))

goi <- subset(data, gene %in% c("miR34a asRNA", "miR34a HG"))
hk <- subset(data, gene == "B-actin")

colnames(goi)[c(5:6)] <- c("Ct1GOI", "Ct2GOI")
colnames(hk)[c(5:6)] <- c("Ct1HK", "Ct2HK")

data <- cbind(goi, hk[,c("Ct1HK", "Ct2HK")])

#ddct
data$meanGOI <- rowMeans(data[,c("Ct1GOI", "Ct2GOI")])
data$meanHK <- rowMeans(data[,c("Ct1HK", "Ct2HK")])
data$dct <- data$meanGOI - data$meanHK
ddct <- ddply(
    data,
    c("gene", "cellLine", "treatment", "experiment"),
    summarize,
    ddct=dct-data[data$gene == gene & data$cellLine == cellLine & data$experiment == 1 & data$treatment == "untreated", "dct"]
)

data <- merge(data, ddct, by=c("gene", "cellLine", "treatment", "experiment"))
data$fold <- 2^-data$ddct
data$log2fold <- log2(data$fold)

#calculate stats
stats <- ddply(
    data, 
    c("gene", "cellLine", "treatment"),
    summarize,
    mean=mean(log2fold),
    pValue=t.test(log2fold, data[data$gene == gene & data$cellLine == cellLine & data$treatment == "untreated", "log2fold"])$p.value,
    CI95l=t.test(log2fold)$conf.int[1],
    CI95h=t.test(log2fold)$conf.int[2]
)

data <- merge(data, stats, by=c("gene", "cellLine", "treatment"))
data$pValue <- ifelse(data$pValue == 1, NA, data$pValue)

data$pStars <- ifelse(
    data$pValue < 0.05 & data$pValue > 0.0049, 
    "\u2605", 
    ifelse(
        data$pValue < 0.005 & data$pValue > 0.00049, 
        "\u2605\u2605",
        ifelse(
            data$pValue < 0.0005, 
            "\u2605\u2605\u2605",
            ""
        )
    )
)

#prepare for plotting
data$treatment <- factor(data$treatment, levels=c("untreated", "doxorubicin"))
```

```{r, fig.align='center', fig.height=8, fig.width=12, eval=TRUE, message=FALSE, warning=FALSE}
#plot for Rmarkdown
ggplot(data, aes(x=treatment, y=log2fold))+
    geom_violin(
        aes(fill=gene),
        trim=TRUE,
        alpha=0.3,
        color=NA,
        scale="width",
        show.legend = FALSE
    )+
    geom_point( 
        aes(colour=gene),
        size=4,
        position=position_dodge(width=0.9)
    )+
    geom_linerange(
        aes(ymin=CI95l, ymax=CI95h, group=gene),
        colour="black",
        position=position_dodge(width=0.9),
        show.legend = FALSE
    )+
    geom_point(
        aes(y=mean, group=gene),
        colour="black",
        position=position_dodge(width=0.9),
        show.legend = FALSE
    )+
    facet_grid(.~cellLine)+
    geom_label(
        aes(y=CI95h+0.15, label=pStars, group=gene),
        label.size=0,
        label.padding=unit(0.01, "lines"),
        show.legend = FALSE,
        fill="white",
        size=5,
        family="Arial Unicode MS",
        position=position_dodge(width=0.9)
    )+
    scale_y_continuous(
        "\u0394\u0394Ct",
        breaks=c(-1,0,1,2,3,4,5),
        sec.axis = sec_axis(
            ~2^., 
            name = expression(2^{- ~ Delta ~ Delta ~ "Ct"}), 
            breaks=c(2^-1,2^0,2^1,2^2,2^3,2^4,2^5)
        )
    )+
    labs(
      x="Treatment",
      title="miR34a asRNA response to p53 induction",
      caption=
            "Q-PCR showing miR34a asRNA and miR34a HG levels in HCT116 and HEK293t cells after treatment with 200 ng/ml doxorubicin for 24hrs.\nError bars (black vertical) indicate 95% CI and means are represented \nby black dots. \u2605 = p < 0.05; \u2605\u2605 = p < 0.005, \u2605\u2605\u2605 = p < 0.0005."
    )+
    theme_few()+
    scale_fill_ptol()+
    scale_colour_ptol()+
    #values=c("#014d64", "#6794a7")
    theme(
        plot.title = element_text(
            hjust = 0.5,
            face="bold",
            size=20
        ),
        plot.caption = element_text(
            hjust=0, 
            margin=margin(t=15),
            family="Arial Unicode MS"
        ),
        legend.position="top",
        legend.title=element_text(size=17),
        legend.text=element_text(size=15),
        axis.title=element_text(size=17),
        axis.title.x=element_text(margin=margin(t=10)),
        axis.text=element_text(size=15),
        strip.text.x=element_text(size=17)
    )+
    guides(color = guide_legend(title = "Gene", override.aes = list(size=3)))
```

#Conclusions
We observed increases in miR34a HG and asRNA expression upon doxorubicin treatment indicating that these two transcripts are co-regulated. 

```{r}
sessionInfo()
```
